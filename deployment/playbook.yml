---
- hosts: app
  become: yes
  vars:
    network: "{{project_name}}"
  roles:
    - name: common
    - name: docker_network
      networks:
        - "{{network}}"
    - name: memcached
      version: "1.6"
    - name: forum
      version: "{{app_version}}"
      network: "{{project_name}}"
    - name: certbot-ovh
      domain: "{{inventory_hostname}}"
    - name: nginx
      version: "1.18"
    # - name: metrics
    #   prometheus_version: latest  # until they have a better taging policy
    #   cadvisor_version: latest    # ...
  tasks:
    # Reclaim hard drive space
    - name: clean outdated docker images & stopped containers
      shell: >
        docker system prune --force &&
        docker rmi $(docker images --quiet --filter dangling=true)
      failed_when: no
      changed_when: no
...
