---
# Install common dependencies
- name: update package repo
  apt: update_cache=yes upgrade=safe
- name: install apt packages
  apt: name={{item}} state=installed
  with_items:
    - acl  # required by Ansible 2.1 to become_user
    - apt-transport-https
    - build-essential
    - curl
    - emacs24-nox
    - git
    - ntp
    - vim

# Common configuration
- name: set timezone variables
  copy:
    content: "Europe/Paris\n"
    dest: "/etc/timezone"
    owner: root
    group: root
    mode: 0644
  notify: update_timezone
- name: generate locale
  locale_gen:
    name: "en_US"
    state: present
- name: set locale
  copy:
    content: "LANG=en_US\nLC_ALL=en_US"
    dest: "/etc/default/locale"
    owner: root
    group: root
    mode: 0644
- name: set default editor to emacs
  alternatives:
    name: editor
    path: "/usr/bin/emacs"

# User configuration
- name: Create user
  user: name="{{app_user}}" shell="/bin/bash"
- name: Copy github credential token
  template:
    src: dotnetrc
    dest: /home/{{app_user}}/.netrc
    owner: "{{app_user}}"
    mode: 0600
- name: Install emacs conf & color scheme
  unarchive:
    src: emacs.tgz
    dest: /home/{{ app_user }}
    creates: /home/{{ app_user }}/.emacs.d/themes/tangotango-theme.el
    owner: "{{ app_user }}"
- name: Install vim conf & color scheme
  unarchive:
    src: vim.tgz
    dest: /home/{{ app_user }}
    creates: /home/{{ app_user }}/.vim/colors/jellybeans.vim
    owner: "{{ app_user }}"
