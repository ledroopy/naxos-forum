{% extends "base.html" %}
{% load static %}
{% load mathfilters %}
{% block content %}
{# Path #}
<ol class="breadcrumb">
  <li><a href="{% url 'forum:top' %}">Accueil</a></li>
  <li class="active">Recherche : {{ query }}</li>
</ol><br>
{# Threads #}
<div class="row">
{% if not object_list %}
  <div class="alert alert-danger">
    <p>Aucun résultat ne correspond à cette recherche.</p>
  </div>
</div>
<hr style="margin:8px; border-top:0">
{% else %}
  {% ifequal model 'thread' %}
  <table class="table table-condensed table-bordered" id="view">
    <thead>
    <tr>
      <th class="text-center" style="padding:5px 0;width:25px"><img src="{% static 'img/detail_search.gif' %}" style="vertical-align:bottom;padding-bottom:3px"></th>
      <th>Message</th>
      <th class="col-xs-2 text-center">Auteur</th>
      <th class="text-center col-xs-1 hidden-xs">Rép.</th>
      <th class="text-center col-xs-1 hidden-xs">Vues</th>
      <th class="text-center col-xs-2 hidden-xs">Dernier message</th>
      <th class="text-center col-xs-2 visible-xs">Dernier</th>
    </tr>
    </thead>
    <tbody>
      {% for thread in object_list %}
      <tr>
        <td class="text-center vert-align" style="padding:0">
          {% if user in thread.contributors.all and thread.posts.latest in user.postsReadCaret.all %}
              <img src="{% static 'img/added.png' %}" style="vertical-align:middle;padding:0 0 3px 0;">
          {% elif user in thread.contributors.all %}
            <a href="{% url 'forum:thread' thread.category.slug thread.slug %}{% for post in user.postsReadCaret.all %}{% ifequal post.thread thread  %}?page={{ post.position|intdiv:post_pagination|add:1 }}#{{ post.pk }}{% endifequal %}{% endfor %}">
              <img src="{% static 'img/added+on.png' %}" style="vertical-align:middle;padding:0 0 3px 0;">
            </a>
          {% elif thread.posts.latest in user.postsReadCaret.all %}
            <img src="{% static 'img/off.png' %}" style="vertical-align:middle;padding:0 0 3px 0;">
          {% else %}
            <a href="{% url 'forum:thread' thread.category.slug thread.slug %}{% for post in user.postsReadCaret.all %}{% ifequal post.thread thread  %}?page={{ post.position|intdiv:post_pagination|add:1 }}#{{ post.pk }}{% endifequal %}{% endfor %}">
              <img src="{% static 'img/on.png' %}" style="vertical-align:middle;padding:0 0 3px 0;">
            </a>
          {% endif %}
        </td>
        <td class="vert-align">
          {% with 'img/thread/'|add:thread.icon as icon %}
            <img src="{% static icon %}" style="vertical-align:bottom;padding-bottom:3px;margin-right:2px">
          {% endwith %}
          {% if thread.isSticky and thread.question %}
            Annonce/Sondage :
          {% elif thread.isSticky %}
            Annonce :
          {% elif thread.question %}
            Sondage :
          {% endif %}
          <a href="{% url 'forum:category' thread.category.slug %}">{{ thread.category.slug }}</a> / 
          <a href="{% url 'forum:thread' thread.category.slug thread.slug %}" style="word-wrap: break-word">{{ thread.title }}</a>
        </td>
        <td class="text-center vert-align importantData">
          <small><strong>{{ thread.author }}</strong></small>
        </td>
        <td class="text-center vert-align hidden-xs"><small>{{ thread.posts.count|add:"-1" }}</small></td>
        <td class="text-center vert-align hidden-xs"><small>{{ thread.viewCount }}</small></td>
        <td class="text-center vert-align importantData" style="line-height:100%">
          <small>
          <a href="{% url 'forum:thread' thread.category.slug thread.slug %}?page=last#{{ thread.posts.latest.pk }}" class="lastMessage">
          {{ thread.modified|date:'d/m/y H:i' }}
          <br><strong>{{ thread.posts.latest.author }}</strong>
          </a>
          </small>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
  {% endifequal %}
  {% ifequal model 'post' %}
        <strong>
            <div class="col-sm-2 hidden-xs text-left post-header" style="border-right:1px solid #f9f9f9">
              Auteur
            </div>
            <div class="col-sm-10 post-header">
              Messages
            </div>
        </strong>
    </div>
    <hr style="margin:1px; border-top:0">
    <script>
        $(document).ready(function() {
            // Ensure presentation is ok on DOM ready().
            $('.equal-divs').responsiveEqualHeightGrid();
        })
        var x = setInterval(function() {
            // Ensure presentation is ok while media still loading.
            $('.equal-divs').responsiveEqualHeightGrid();
        }, 500);
        $(window).load(function() {
            // Stops presentation refresh when everything loaded.
            clearInterval(x);
        });
    </script>
    {% for post in object_list %}
    <div class="row">
        <a name="{{ post.pk }}"></a>
        {# Large display author #}
        <div class="col-sm-2 text-center hidden-xs equal-divs" style="padding: 10px 0px; border-right:1px solid #f9f9f9; background-color: #f2f2f2;">
          <p style="word-wrap: break-word">
              <strong>{{ post.author }}</strong><br>
              {% if post.author.quote %}
                  <small>{{ post.author.quote }}</small>
              {% endif %}
          </p>
          {% if post.author.logo %}
              <p><img src="{{ media }}{{ post.author.logo }}" alt=""></p>
          {% endif %}
          <p style="font-size:10px">depuis le {{ post.author.date_joined|date:'d/m/Y' }}</p>
        </div>
        {# Content #}
        <div class="col-sm-10 post equal-divs">
          <span class="visible-xs" style="display:inline!important"><strong>{{ post.author }}</strong> | </span>
          <small>
            Posté le {{ post.created|date:"j F Y à H:i:s" }} | 
            {% if post.thread.question %}
                Sondage : 
            {% else %}
                Sujet : 
            {% endif %}
            <strong><a href="{% url 'forum:thread' post.thread.category.slug post.thread.slug %}">{{ post.thread.title }}</a></strong>
          </small>
          <hr style="margin:5px 0 8px 0; border-top: 1px solid #ccc">
          <div class="post-content" style="word-wrap: break-word">
              {{ post.content_html|safe }}
          </div>
          {% if post.modified %}
              <br><br>
              <p style="font-size:9px">— Modifié le {{ post.modified|date:"j F Y à H:i:s" }}</p>
          {% endif %}
        </div>
    </div>
    <hr style="margin:8px; border-top:0">
    {% endfor %}
    <hr style="margin:8px; border-top:0">
  {% endifequal %}
{% endif %}
<div class="row" style="padding: 5px 0">
  <a href="#" onclick="window.history.back();return false;"><button class="btn btn-default pull-left">Retour</button></a>
</div>
{% ifequal model 'thread' %} 
  {# Caption #}
  <hr style="margin:8px; border-top:0">
  <div class="row">
      <div class="col-xs-12">
          <h6 style="text-decoration:underline">Légende</h6>
      </div>
  </div>
  <div class="row hidden-sm hidden-xs">  {# Large #}
      <div class="col-md-4">
          <small>Sujets auxquels vous avez participé</small>
          <p class="legend"><img src="{% static 'img/added+on.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Des messages non lus depuis votre dernière visite</small></p>
          <p class="legend"><img src="{% static 'img/added.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Aucun message non lu depuis votre dernière visite</small></p>
      </div>
      <div class="col-md-4">
          <small>Sujets auxquels vous n'avez pas participé</small>
          <p class="legend"><img src="{% static 'img/on.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Des messages non lus depuis votre dernière visite</small></p>
          <p class="legend"><img src="{% static 'img/off.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Aucun message non lu depuis votre dernière visite</small></p>
      </div>
  </div>
  <div class="row hidden-lg hidden-md">  {# Small #}
      <div class="col-xs-6">
          <small>Sujets auxquels vous avez participé</small>
          <p class="legend"><img src="{% static 'img/added+on.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Des messages non lus depuis votre dernière visite</small></p>
          <p class="legend"><img src="{% static 'img/added.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Aucun message non lu depuis votre dernière visite</small></p>
      </div>
      <div class="col-xs-6">
          <small>Sujets auxquels vous n'avez pas participé</small>
          <p class="legend"><img src="{% static 'img/on.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Des messages non lus depuis votre dernière visite</small></p>
          <p class="legend"><img src="{% static 'img/off.png' %}" style="vertical-align:middle;padding:0 5px 3px 0;"><small>Aucun message non lu depuis votre dernière visite</small></p>
      </div>
  </div>
{% endifequal %}
{# Pagination #}
<div class="col-md-12 text-center">
{% if is_paginated %}
<div class="pagination">
    <span class="page-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&lt;&lt; </a>
            <a href="?page={{ page_obj.previous_page_number }}">Précédente</a>
        {% endif %}
        <span class="page-current">
            Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}
        </span>
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">Suivante</a>
            <a href="?page=last">&gt;&gt;</a>
        {% endif %}
    </span>
</div>
{% endif %}
</div>
{% endblock %}